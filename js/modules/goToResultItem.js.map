{"version":3,"names":[],"mappings":"","sources":["modules/goToResultItem.js"],"sourcesContent":["import GetAuthorizationHeader from \"getAurthor.js\";\r\nimport makeInfoCards from \"makeINfoCards.js\";\r\nimport showCard from \"showCard.js\";\r\n\r\nconst Icon = L.Icon.extend({\r\n  options: {\r\n    iconSize: [57.46, 56],\r\n    iconAnchor: [25, 52],\r\n  }\r\n});\r\n\r\nconst rentIcon = new Icon({iconUrl: 'images/rent_icon.png'});\r\n\r\nexport default function goToResultItem(stationData, map) {\r\n  const resultItems = document.querySelectorAll('.searchResultItem');\r\n  resultItems.forEach(item => {\r\n    item.addEventListener('click', e => {\r\n      e.preventDefault();\r\n      \r\n      if (e.target.dataset.positionLat === undefined) {\r\n        alert('未提供位置資訊')\r\n        return;\r\n      }\r\n\r\n      // set map center\r\n      const lat = parseFloat(e.target.dataset.positionLat)\r\n      const lon = parseFloat(e.target.dataset.positionLon)\r\n      let position = [lat, lon];\r\n      map.setView(position, 16);\r\n\r\n      const id = e.target.dataset.stationid;\r\n      const city = document.querySelector('#citySelector').value;\r\n\r\n      axios({\r\n        method: 'get',\r\n        baseURL: 'https://ptx.transportdata.tw/MOTC/',\r\n        url: `v2/Bike/Availability/${city}?$format=JSON`,\r\n        headers: GetAuthorizationHeader()    \r\n      })\r\n        .then(res => {\r\n          const bikes = res.data;\r\n          const bikeData = [];\r\n          \r\n          bikes.forEach(bike => {\r\n            let rentBike = bike.AvailableRentBikes;\r\n            if (bike.StationID === id) {\r\n              bikeData.push(bike)\r\n              stationData.forEach(station => {\r\n                if (station.StationID === id) {\r\n\r\n                  L.marker([lat, lon], { icon: rentIcon })\r\n                  .bindPopup(`<a title=\"可借數量\" href=\"#\" data-marker=\"marker\" class=\"map-marker text-primary text-decoration-none\" data-stationid=\"${id}\">${rentBike}</a>`, {\r\n                    minWidth: 0,\r\n                    closeButton: false,\r\n                    autoClose: false,\r\n                    closeOnClick: false,\r\n                  })\r\n                  .on(\"add\", event => {\r\n                    event.target.openPopup();\r\n\r\n                    const mapMarkers = document.querySelectorAll('.map-marker');\r\n                  mapMarkers.forEach(marker => {\r\n                    marker.addEventListener('click', e => {\r\n                      e.preventDefault();\r\n            \r\n                      showCard(e);\r\n                    })\r\n                  })\r\n\r\n                  }).addTo(map);\r\n        \r\n                }\r\n              })\r\n\r\n            }\r\n          })\r\n          \r\n          makeInfoCards(stationData, bikeData, true);\r\n          \r\n        })\r\n        .catch(err => console.log(err));\r\n        \r\n      })\r\n    })\r\n\r\n}"],"file":"goToResultItem.js"}