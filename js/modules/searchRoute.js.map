{"version":3,"names":[],"mappings":"","sources":["modules/searchRoute.js"],"sourcesContent":["import GetAuthorizationHeader from \"./getAurthor.js\";\r\nimport searchRouteInTown from \"./searchRouteInTown.js\";\r\nimport showRoute from \"./showRoute.js\";\r\n\r\nexport default function searchRoute() {\r\n\r\n  const city = document.querySelector('#citySelectorForRoute').value;\r\n  const routeContainer = document.querySelector('#routeResultContainer');\r\n  const townSelector = document.querySelector('#townSelector');\r\n\r\n  let routes = '';\r\n\r\n  if (city === '') {\r\n    routes = `<div class=\"alert alert-light text-center\" role=\"alert\">\r\n                請選擇地區\r\n              </div>`;\r\n    routeContainer.innerHTML = routes;\r\n    return;\r\n  }\r\n\r\n  axios({\r\n    method: 'get',\r\n    baseURL: 'https://ptx.transportdata.tw/MOTC/',\r\n    url: `v2/Cycling/Shape/${city}?$format=JSON`,\r\n    hearders: GetAuthorizationHeader()\r\n  })\r\n    .then(res => {\r\n      const routeData = res.data;\r\n      let options = [];\r\n      let townOptions = '';\r\n\r\n      routeData.forEach(route => {\r\n        let town = route.Town;\r\n        if (!options.includes(town) && town !== undefined) {\r\n          options.push(town);\r\n          townOptions += `<option value=\"${town}\">${town}</option>`;\r\n        }\r\n\r\n        let name = route.RouteName;\r\n        let start = route.RoadSectionStart || '無資料';\r\n        let end = route.RoadSectionEnd || '無資料';\r\n        let length = route.CyclingLength + 'm' || '';\r\n        let direction = route.Direction || '';\r\n        let routeSection = route.Geometry || '無資料';\r\n\r\n        routes += `\r\n          <a href=\"#\" class=\"searchRouteResult list-group-item list-group-item-action border-0 border-bottom p-3 pe-4\" title=\"顯示路線位置\" data-section=\"${routeSection}\">\r\n            <h5 class=\"fw-700 mb-1 fs-15 mb-0\" data-section=\"${routeSection}\">${name}</h5>\r\n            <p class=\"fw-500 fs-14 mb-0\" data-section=\"${routeSection}\">起點：${start}</p>\r\n            <p class=\"fw-500 mb-1 fs-14 mb-0\" data-section=\"${routeSection}\">終點：${end}</p>\r\n            <small class=\"fs-12 lh-sm\" data-section=\"${routeSection}\">${length}</small>\r\n            <small class=\"fs-12 lh-sm text-info ms-4\" data-section=\"${routeSection}\">${direction}</small>\r\n          </a>\r\n        `;\r\n\r\n      });\r\n      townSelector.innerHTML = townOptions;\r\n      routeContainer.innerHTML = routes;\r\n      \r\n      return routeData;\r\n    })\r\n    .then(data => {\r\n\r\n      const searchRouteResults = document.querySelectorAll('.searchRouteResult');\r\n      searchRouteResults.forEach(result => {\r\n        result.addEventListener('click', e => {\r\n          e.preventDefault()\r\n\r\n          // the show route function\r\n          showRoute(e);\r\n\r\n        })\r\n      })\r\n\r\n      townSelector.addEventListener('change', e => {\r\n        e.preventDefault();\r\n        searchRouteInTown(data);\r\n      })\r\n    })\r\n    .catch(err => {\r\n      console.log(err)\r\n      routes = `<div class=\"alert alert-light text-center\" role=\"alert\">\r\n                  無資料\r\n                </div>`;\r\n      routeContainer.innerHTML = routes;\r\n    });\r\n\r\n  }"],"file":"searchRoute.js"}