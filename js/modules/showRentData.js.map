{"version":3,"names":[],"mappings":"","sources":["modules/showRentData.js"],"sourcesContent":["import GetAuthorizationHeader from './getAurthor.js';\r\nimport makeInfoCards from './makeINfoCards.js';\r\nimport showCard from './showCard.js';\r\n\r\n\r\nexport default function showRentData(nowLat, nowLong, map, layerGroup, num = 30) {\r\n  \r\n  // custom icon\r\n  const Icon = L.Icon.extend({\r\n    options: {\r\n      iconSize: [57.46, 56],\r\n      iconAnchor: [25, 52],\r\n    }\r\n  });\r\n  \r\n  const rentIcon = new Icon({iconUrl: 'images/rent_icon.png'});\r\n  \r\n  const requestStation = axios({\r\n    method: 'get',\r\n    baseURL: 'https://ptx.transportdata.tw/MOTC/',\r\n    url: `v2/Bike/Station/NearBy?$top=${num}&$spatialFilter=nearby(${nowLat},${nowLong},1000)&$format=JSON`,\r\n    headers: GetAuthorizationHeader()    \r\n  });\r\n  const requestAvailability = axios({\r\n    method: 'get',\r\n    baseURL: 'https://ptx.transportdata.tw/MOTC/',\r\n    url: `v2/Bike/Availability/NearBy?$top=${num}&$spatialFilter=nearby(${nowLat},${nowLong},1000)&$format=JSON`,\r\n    headers: GetAuthorizationHeader() \r\n  });\r\n\r\n  axios.all([requestStation, requestAvailability])\r\n    .then(axios.spread((...res) => {\r\n\r\n      const stations = res[0].data;\r\n      const bikes = res[1].data;\r\n\r\n      // info cards\r\n      makeInfoCards(stations, bikes, true);\r\n      \r\n      stations.forEach(item => {\r\n        let stationID = item.StationID;\r\n        let lat = item.StationPosition.PositionLat;\r\n        let long = item.StationPosition.PositionLon;\r\n        \r\n        bikes.forEach(bike => {\r\n          if (stationID === bike.StationID) {\r\n            let rentBike = bike.AvailableRentBikes;\r\n            \r\n            layerGroup.addLayer(\r\n              L.marker([lat,long], { icon: rentIcon })\r\n              .bindPopup(`<a title=\"可借數量\" href=\"#\" id=\"${stationID}\" data-marker=\"marker\" class=\"map-marker text-primary text-decoration-none\" data-stationid=\"${stationID}\">${rentBike}</a>`, {\r\n                minWidth: 0,\r\n                closeButton: false,\r\n                autoClose: false,\r\n                closeOnClick: false,\r\n              })\r\n              .on(\"add\", event => {\r\n                event.target.openPopup();\r\n\r\n                const mapMarkers = document.querySelectorAll('.map-marker');\r\n                  mapMarkers.forEach(marker => {\r\n                    marker.addEventListener('click', e => {\r\n                      e.preventDefault();\r\n            \r\n                      showCard(e);\r\n                    })\r\n                  })\r\n\r\n              }))\r\n            }\r\n\r\n        })\r\n        \r\n      })\r\n      layerGroup.addTo(map);\r\n\r\n    }))\r\n    .catch(err => console.log(err));\r\n}\r\n\r\n"],"file":"showRentData.js"}