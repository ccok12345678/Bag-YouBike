{"version":3,"names":[],"mappings":"","sources":["modules/showReturnData.js"],"sourcesContent":["import GetAuthorizationHeader from './getAurthor.js';\r\nimport makeInfoCards from './makeInfoCards.js';\r\nimport showCard from './showCard.js';\r\n\r\nexport default function showReturnData(nowLat, nowLong, map, layerGroup) {\r\n  const Icon = L.Icon.extend({\r\n    options: {\r\n      iconSize: [57.46, 56],\r\n      iconAnchor: [25, 52],\r\n    }\r\n  });\r\n  \r\n  const returnIcon = new Icon({iconUrl: 'images/return_icon.png'});\r\n  \r\n  const requestStation = axios({\r\n    method: 'get',\r\n    baseURL: 'https://ptx.transportdata.tw/MOTC/',\r\n    url: `v2/Bike/Station/NearBy?$top=30&$spatialFilter=nearby(${nowLat},${nowLong},1000)&$format=JSON`,\r\n    headers: GetAuthorizationHeader()    \r\n  });\r\n  const requestAvailability = axios({\r\n    method: 'get',\r\n    baseURL: 'https://ptx.transportdata.tw/MOTC/',\r\n    url: `v2/Bike/Availability/NearBy?$top=30&$spatialFilter=nearby(${nowLat},${nowLong},1000)&$format=JSON`,\r\n    headers: GetAuthorizationHeader() \r\n  });\r\n\r\n  axios.all([requestStation, requestAvailability])\r\n    .then(axios.spread((...res) => {\r\n\r\n      const stations = res[0].data;\r\n      const bikes = res[1].data;\r\n      \r\n      // info cards\r\n      makeInfoCards(stations, bikes, false);\r\n\r\n      stations.forEach(item => {\r\n        let stationID = item.StationID;\r\n        let lat = item.StationPosition.PositionLat;\r\n        let long = item.StationPosition.PositionLon;\r\n        \r\n        bikes.forEach(bike => {\r\n          if (stationID === bike.StationID) {\r\n            let returnBike = bike.AvailableReturnBikes;\r\n\r\n            layerGroup.addLayer(\r\n              L.marker([lat,long], { icon: returnIcon })\r\n                .bindPopup(`<a title=\"可還車位\" href=\"#\" id=\"${stationID}\" data-marker=\"marker\" class=\"map-marker text-secondary text-decoration-none\" data-stationid=\"${stationID}\"\">${returnBike}</a>`, {\r\n                  minWidth: 0,\r\n                  closeButton: false,\r\n                  autoClose: false,\r\n                  closeOnClick: false,\r\n                })\r\n                .on(\"add\", event => {\r\n                  event.target.openPopup();\r\n                  \r\n                  const mapMarkers = document.querySelectorAll('.map-marker');\r\n                  mapMarkers.forEach(marker => {\r\n                    marker.addEventListener('click', e => {\r\n                      e.preventDefault();\r\n            \r\n                      showCard(e);\r\n                    })\r\n                  })\r\n\r\n            }))\r\n          }\r\n\r\n        })\r\n        \r\n      })\r\n      layerGroup.addTo(map);\r\n\r\n\r\n    }))\r\n    .catch(err => console.log(err));\r\n}"],"file":"showReturnData.js"}